# –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: Telegram Bot –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
telegram_finance_bot/
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ create_bot.py
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ expenses.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ instructions.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common.py
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inline.py
‚îÇ   ‚îî‚îÄ‚îÄ states/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ expense.py
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ   ‚îî‚îÄ‚îÄ crud.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ google_sheets.py
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py
‚îÇ   ‚îî‚îÄ‚îÄ notifications.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ bot.db
    ‚îî‚îÄ‚îÄ credentials.json
```

## üì¶ requirements.txt

```txt
aiogram==3.10.0
sqlalchemy==2.0.23
aiosqlite==0.19.0
apscheduler==3.10.4
gspread==5.12.4
oauth2client==4.1.3
python-dotenv==1.0.0
pytz==2023.3
asyncio-mqtt==0.16.1
```

## ‚öôÔ∏è .env.example

```env
# Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
BOT_TOKEN=your_bot_token_here

# Google Sheets ID (–∏–∑ URL —Ç–∞–±–ª–∏—Ü—ã)
GOOGLE_SHEETS_ID=your_google_sheets_id_here

# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
TIMEZONE=Asia/Bishkek

# –í—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
REMINDER_TIME=20:00

# –ö–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
AUTH_CODE_USER1=SECURE_CODE_123
AUTH_CODE_USER2=SECURE_CODE_456  
AUTH_CODE_USER3=SECURE_CODE_789

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=sqlite+aiosqlite:///./data/bot.db

# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
DEBUG=True
```

## üóÑÔ∏è config.py

```python
import os
from dotenv import load_dotenv

load_dotenv()

class Config:
    BOT_TOKEN = os.getenv("BOT_TOKEN")
    GOOGLE_SHEETS_ID = os.getenv("GOOGLE_SHEETS_ID") 
    TIMEZONE = os.getenv("TIMEZONE", "Asia/Bishkek")
    REMINDER_TIME = os.getenv("REMINDER_TIME", "20:00")
    DATABASE_URL = os.getenv("DATABASE_URL", "sqlite+aiosqlite:///./data/bot.db")
    DEBUG = os.getenv("DEBUG", "False").lower() == "true"
    
    # –ö–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    AUTH_CODES = {
        os.getenv("AUTH_CODE_USER1"): "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1",
        os.getenv("AUTH_CODE_USER2"): "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2", 
        os.getenv("AUTH_CODE_USER3"): "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 3"
    }
    
    # Google Credentials –ø—É—Ç—å
    GOOGLE_CREDENTIALS = "./data/credentials.json"

config = Config()
```

## üóÉÔ∏è database/models.py

```python
from sqlalchemy import Column, Integer, String, Boolean, DateTime, Decimal, ForeignKey, Text
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship
from datetime import datetime

Base = declarative_base()

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    telegram_id = Column(Integer, unique=True, index=True)
    username = Column(String, nullable=True)
    full_name = Column(String, nullable=False)
    is_authorized = Column(Boolean, default=False)
    auth_code = Column(String, nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    last_expense_date = Column(DateTime, nullable=True)
    
    # –°–≤—è–∑—å —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏
    expenses = relationship("Expense", back_populates="user")

class Expense(Base):
    __tablename__ = "expenses"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    amount = Column(Decimal(precision=10, scale=2), nullable=False)
    purpose = Column(Text, nullable=False)
    expense_date = Column(DateTime, default=datetime.utcnow)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    user = relationship("User", back_populates="expenses")

class DailyReminder(Base):
    __tablename__ = "daily_reminders"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    reminder_date = Column(DateTime, nullable=False)
    is_completed = Column(Boolean, default=False)
    reminder_count = Column(Integer, default=0)
    created_at = Column(DateTime, default=datetime.utcnow)
```

## üîó database/database.py

```python
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker
from sqlalchemy.orm import declarative_base
from config import config
from database.models import Base

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤–∏–∂–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
engine = create_async_engine(
    config.DATABASE_URL,
    echo=config.DEBUG
)

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π
AsyncSessionLocal = async_sessionmaker(
    engine, 
    class_=AsyncSession, 
    expire_on_commit=False
)

async def create_tables():
    """–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

async def get_async_session():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()
        except Exception:
            await session.rollback()
            raise
        finally:
            await session.close()
```

## üíæ database/crud.py

```python
from sqlalchemy import select, and_, func
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload
from database.models import User, Expense, DailyReminder
from datetime import datetime, date
from typing import Optional, List

class UserCRUD:
    @staticmethod
    async def get_user_by_telegram_id(db: AsyncSession, telegram_id: int) -> Optional[User]:
        result = await db.execute(select(User).where(User.telegram_id == telegram_id))
        return result.scalar_one_or_none()
    
    @staticmethod
    async def create_user(db: AsyncSession, telegram_id: int, username: str, full_name: str, auth_code: str) -> User:
        user = User(
            telegram_id=telegram_id,
            username=username,
            full_name=full_name,
            auth_code=auth_code,
            is_authorized=True
        )
        db.add(user)
        await db.commit()
        await db.refresh(user)
        return user
    
    @staticmethod
    async def get_all_authorized_users(db: AsyncSession) -> List[User]:
        result = await db.execute(select(User).where(User.is_authorized == True))
        return result.scalars().all()

class ExpenseCRUD:
    @staticmethod
    async def create_expense(db: AsyncSession, user_id: int, amount: float, purpose: str) -> Expense:
        expense = Expense(
            user_id=user_id,
            amount=amount,
            purpose=purpose
        )
        db.add(expense)
        await db.commit()
        await db.refresh(expense)
        return expense
    
    @staticmethod
    async def get_user_expenses_by_date(db: AsyncSession, user_id: int, target_date: date) -> List[Expense]:
        start_datetime = datetime.combine(target_date, datetime.min.time())
        end_datetime = datetime.combine(target_date, datetime.max.time())
        
        result = await db.execute(
            select(Expense)
            .where(and_(
                Expense.user_id == user_id,
                Expense.expense_date >= start_datetime,
                Expense.expense_date <= end_datetime
            ))
        )
        return result.scalars().all()
    
    @staticmethod
    async def get_all_expenses_by_date(db: AsyncSession, target_date: date) -> List[Expense]:
        start_datetime = datetime.combine(target_date, datetime.min.time())
        end_datetime = datetime.combine(target_date, datetime.max.time())
        
        result = await db.execute(
            select(Expense)
            .options(selectinload(Expense.user))
            .where(and_(
                Expense.expense_date >= start_datetime,
                Expense.expense_date <= end_datetime
            ))
        )
        return result.scalars().all()

class ReminderCRUD:
    @staticmethod
    async def create_daily_reminder(db: AsyncSession, user_id: int, reminder_date: datetime) -> DailyReminder:
        reminder = DailyReminder(
            user_id=user_id,
            reminder_date=reminder_date
        )
        db.add(reminder)
        await db.commit()
        await db.refresh(reminder)
        return reminder
    
    @staticmethod
    async def get_pending_reminders(db: AsyncSession, target_date: date) -> List[DailyReminder]:
        start_datetime = datetime.combine(target_date, datetime.min.time())
        end_datetime = datetime.combine(target_date, datetime.max.time())
        
        result = await db.execute(
            select(DailyReminder)
            .options(selectinload(DailyReminder.user))
            .where(and_(
                DailyReminder.reminder_date >= start_datetime,
                DailyReminder.reminder_date <= end_datetime,
                DailyReminder.is_completed == False
            ))
        )
        return result.scalars().all()
    
    @staticmethod
    async def mark_reminder_completed(db: AsyncSession, reminder_id: int):
        result = await db.execute(select(DailyReminder).where(DailyReminder.id == reminder_id))
        reminder = result.scalar_one_or_none()
        if reminder:
            reminder.is_completed = True
            await db.commit()
```

## üîê bot/middlewares/auth.py

```python
from typing import Callable, Dict, Any, Awaitable
from aiogram import BaseMiddleware
from aiogram.types import Message, CallbackQuery
from database.database import AsyncSessionLocal
from database.crud import UserCRUD

class AuthMiddleware(BaseMiddleware):
    """Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    def __init__(self):
        super().__init__()
    
    async def __call__(
        self,
        handler: Callable[[Message, Dict[str, Any]], Awaitable[Any]],
        event: Message | CallbackQuery,
        data: Dict[str, Any]
    ) -> Any:
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ä—Ç–∞
        if isinstance(event, Message):
            if event.text and (event.text.startswith('/auth') or event.text.startswith('/start')):
                return await handler(event, data)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        async with AsyncSessionLocal() as db:
            user = await UserCRUD.get_user_by_telegram_id(db, event.from_user.id)
            
            if not user or not user.is_authorized:
                await event.answer("‚ùå –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /auth [–∫–æ–¥]")
                return
            
            data['current_user'] = user
            return await handler(event, data)
```

## ‚å®Ô∏è bot/keyboards/inline.py

```python
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

def get_main_menu_keyboard() -> InlineKeyboardMarkup:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üí∞ –†–∞—Å—Ö–æ–¥", callback_data="expense")],
        [InlineKeyboardButton(text="üìä –°—Ç–∞—Ç—É—Å", callback_data="status")],
        [InlineKeyboardButton(text="üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", callback_data="instructions")],
    ])
    return keyboard

def get_confirmation_keyboard() -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(text="‚úÖ –î–∞", callback_data="confirm_yes"),
            InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="confirm_no")
        ]
    ])
    return keyboard

def get_expense_completed_keyboard() -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")],
        [InlineKeyboardButton(text="üí∞ –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ —Ä–∞—Å—Ö–æ–¥", callback_data="expense")]
    ])
    return keyboard
```

## üìä services/google_sheets.py

```python
import gspread
from oauth2client.service_account import ServiceAccountCredentials
from config import config
from typing import List, Dict
import logging
from datetime import datetime

logger = logging.getLogger(__name__)

class GoogleSheetsService:
    def __init__(self):
        self.scope = [
            'https://spreadsheets.google.com/feeds',
            'https://www.googleapis.com/auth/drive'
        ]
        self.credentials = None
        self.client = None
        self.sheet = None
        self._initialize()
    
    def _initialize(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Sheets"""
        try:
            self.credentials = ServiceAccountCredentials.from_json_keyfile_name(
                config.GOOGLE_CREDENTIALS, self.scope
            )
            self.client = gspread.authorize(self.credentials)
            self.sheet = self.client.open_by_key(config.GOOGLE_SHEETS_ID)
            logger.info("Google Sheets –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Sheets: {e}")
    
    async def add_expense_to_sheet(self, user_name: str, amount: float, purpose: str, expense_date: datetime):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü—É"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç "–†–∞—Å—Ö–æ–¥—ã"
            try:
                worksheet = self.sheet.worksheet("–†–∞—Å—Ö–æ–¥—ã")
            except gspread.WorksheetNotFound:
                worksheet = self.sheet.add_worksheet(title="–†–∞—Å—Ö–æ–¥—ã", rows="1000", cols="6")
                # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                worksheet.append_row(["–î–∞—Ç–∞", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–°—É–º–º–∞", "–¶–µ–ª—å", "–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏"])
            
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            row_data = [
                expense_date.strftime("%d.%m.%Y"),
                user_name,
                float(amount),
                purpose,
                expense_date.strftime("%d.%m.%Y %H:%M:%S")
            ]
            
            worksheet.append_row(row_data)
            logger.info(f"–†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ Google Sheets: {user_name} - {amount}")
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞ –≤ Google Sheets: {e}")
            raise
    
    async def get_status_data(self) -> Dict[str, any]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç "–°—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã–µ" 
            try:
                worksheet = self.sheet.worksheet("–°—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã–µ")
            except gspread.WorksheetNotFound:
                # –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                worksheet = self.sheet.add_worksheet(title="–°—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã–µ", rows="10", cols="2")
                # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                initial_data = [
                    ["–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å", "–ó–Ω–∞—á–µ–Ω–∏–µ"],
                    ["–û–±—â–∏–π –æ–±–æ—Ä–æ—Ç", "0"],
                    ["–î–æ–ª–≥–∏ –≤ —Ä—ã–Ω–∫–µ", "0"], 
                    ["–õ–∏—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã", "0"],
                    ["–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å", "0"],
                    ["–û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 1", "0"],
                    ["–û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 2", "0"]
                ]
                for row in initial_data:
                    worksheet.append_row(row)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            all_values = worksheet.get_all_values()
            
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å–ª–æ–≤–∞—Ä—å (–ø—Ä–æ–ø—É—Å–∫–∞—è –∑–∞–≥–æ–ª–æ–≤–æ–∫)
            status_data = {}
            for row in all_values[1:]:  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (–∑–∞–≥–æ–ª–æ–≤–∫–∏)
                if len(row) >= 2:
                    key = row[0]
                    value = row[1]
                    try:
                        # –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                        status_data[key] = float(value) if value else 0.0
                    except ValueError:
                        status_data[key] = value
            
            return status_data
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–∞: {e}")
            return {}

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞
google_sheets_service = GoogleSheetsService()
```

## üïê services/scheduler.py

```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
from apscheduler.triggers.interval import IntervalTrigger
from database.database import AsyncSessionLocal
from database.crud import UserCRUD, ReminderCRUD
from services.notifications import NotificationService
from config import config
import pytz
import logging
from datetime import datetime, date

logger = logging.getLogger(__name__)

class SchedulerService:
    def __init__(self, bot):
        self.scheduler = AsyncIOScheduler(timezone=pytz.timezone(config.TIMEZONE))
        self.bot = bot
        self.notification_service = NotificationService(bot)
    
    def start(self):
        """–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞"""
        # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ 20:00
        hour, minute = map(int, config.REMINDER_TIME.split(':'))
        
        self.scheduler.add_job(
            self._send_daily_reminders,
            CronTrigger(hour=hour, minute=minute, timezone=pytz.timezone(config.TIMEZONE)),
            id='daily_reminder',
            name='–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–∞—Å—Ö–æ–¥–∞—Ö'
        )
        
        # –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å –ø–æ—Å–ª–µ 20:00
        self.scheduler.add_job(
            self._send_hourly_reminders,
            CronTrigger(minute=0, timezone=pytz.timezone(config.TIMEZONE)),
            id='hourly_reminder', 
            name='–ü–æ—á–∞—Å–æ–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'
        )
        
        # –°–±—Ä–æ—Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –ø–æ–ª–Ω–æ—á—å
        self.scheduler.add_job(
            self._reset_daily_reminders,
            CronTrigger(hour=0, minute=0, timezone=pytz.timezone(config.TIMEZONE)),
            id='reset_reminders',
            name='–°–±—Ä–æ—Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π'
        )
        
        self.scheduler.start()
        logger.info("–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω")
    
    async def _send_daily_reminders(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ 20:00"""
        logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
        
        async with AsyncSessionLocal() as db:
            users = await UserCRUD.get_all_authorized_users(db)
            
            for user in users:
                # –°–æ–∑–¥–∞–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –ë–î
                await ReminderCRUD.create_daily_reminder(db, user.id, datetime.now())
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                await self.notification_service.send_daily_reminder(user.telegram_id)
    
    async def _send_hourly_reminders(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—á–∞—Å–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª"""
        current_hour = datetime.now(pytz.timezone(config.TIMEZONE)).hour
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 20:00 –∏ –¥–æ 23:59
        if current_hour < 20:
            return
        
        logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—á–∞—Å–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
        
        async with AsyncSessionLocal() as db:
            today = date.today()
            pending_reminders = await ReminderCRUD.get_pending_reminders(db, today)
            
            for reminder in pending_reminders:
                reminder.reminder_count += 1
                await db.commit()
                
                await self.notification_service.send_hourly_reminder(
                    reminder.user.telegram_id, 
                    reminder.reminder_count
                )
    
    async def _reset_daily_reminders(self):
        """–°–±—Ä–æ—Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –ø–æ–ª–Ω–æ—á—å"""
        logger.info("–°–±—Ä–æ—Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    
    def stop(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞"""
        self.scheduler.shutdown()
        logger.info("–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
```

## üì¢ services/notifications.py

```python
from aiogram import Bot
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
import logging

logger = logging.getLogger(__name__)

class NotificationService:
    def __init__(self, bot: Bot):
        self.bot = bot
    
    async def send_daily_reminder(self, telegram_id: int):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ 20:00"""
        try:
            keyboard = InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="üí∞ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥", callback_data="expense")],
                [InlineKeyboardButton(text="üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å", callback_data="status")]
            ])
            
            message = (
                "üïê <b>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</b>\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è.\n"
                "–ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –±—ã–ª–æ - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ —É–∫–∞–∂–∏—Ç–µ 0.\n\n"
                "üìù –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Ç–æ—á–Ω—ã–π —É—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –±–∏–∑–Ω–µ—Å–∞."
            )
            
            await self.bot.send_message(
                chat_id=telegram_id,
                text=message,
                parse_mode="HTML",
                reply_markup=keyboard
            )
            
            logger.info(f"–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}")
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}: {e}")
    
    async def send_hourly_reminder(self, telegram_id: int, reminder_count: int):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"""
        try:
            keyboard = InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="üí∞ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ —Å–µ–π—á–∞—Å", callback_data="expense")]
            ])
            
            message = (
                f"‚è∞ <b>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ #{reminder_count}</b>\n\n"
                "–í—ã –µ—â–µ –Ω–µ —É–∫–∞–∑–∞–ª–∏ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è.\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–µ—Å–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–∞—Ç–∞—Ö.\n\n"
                "üí° –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –±—ã–ª–æ, —É–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É 0."
            )
            
            await self.bot.send_message(
                chat_id=telegram_id,
                text=message,
                parse_mode="HTML", 
                reply_markup=keyboard
            )
            
            logger.info(f"–ü–æ—á–∞—Å–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ #{reminder_count} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}")
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}: {e}")
```

## üè† bot/handlers/common.py

```python
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message, CallbackQuery
from bot.keyboards.inline import get_main_menu_keyboard

router = Router()

@router.message(Command("start"))
async def start_handler(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    welcome_text = (
        "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ë–æ—Ç–∞!</b>\n\n"
        "üîê –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: <code>/auth –í–ê–®_–ö–û–î</code>\n\n"
        "üìû –ó–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∫–æ–¥–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
    )
    
    await message.answer(welcome_text, parse_mode="HTML")

@router.callback_query(F.data == "main_menu")
async def main_menu_callback(callback: CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    menu_text = (
        "üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    
    await callback.message.edit_text(
        menu_text,
        parse_mode="HTML",
        reply_markup=get_main_menu_keyboard()
    )
    await callback.answer()

@router.message()
async def show_main_menu(message: Message, current_user):
    """–ü–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    menu_text = (
        f"üë§ <b>{current_user.full_name}</b>\n"
        f"üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    
    await message.answer(
        menu_text,
        parse_mode="HTML",
        reply_markup=get_main_menu_keyboard()
    )
```

## üîê bot/handlers/auth.py

```python
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message
from database.database import AsyncSessionLocal
from database.crud import UserCRUD
from config import config
import logging

logger = logging.getLogger(__name__)
router = Router()

@router.message(Command("auth"))
async def auth_handler(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã
        command_parts = message.text.split()
        if len(command_parts) != 2:
            await message.answer(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã.\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: <code>/auth –í–ê–®_–ö–û–î</code>",
                parse_mode="HTML"
            )
            return
        
        auth_code = command_parts[1]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        if auth_code not in config.AUTH_CODES:
            await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.")
            return
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–æ–¥—É
        user_name = config.AUTH_CODES[auth_code]
        
        async with AsyncSessionLocal() as db:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            existing_user = await UserCRUD.get_user_by_telegram_id(db, message.from_user.id)
            
            if existing_user and existing_user.is_authorized:
                await message.answer("‚úÖ –í—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.")
                return
            
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
            if not existing_user:
                user = await UserCRUD.create_user(
                    db=db,
                    telegram_id=message.from_user.id,
                    username=message.from_user.username or "",
                    full_name=user_name,
                    auth_code=auth_code
                )
            else:
                existing_user.is_authorized = True
                existing_user.auth_code = auth_code
                existing_user.full_name = user_name
                await db.commit()
                user = existing_user
            
            success_text = (
                f"‚úÖ <b>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</b>\n\n"
                f"üë§ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <b>{user.full_name}</b>\n\n"
                f"ü§ñ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.\n"
                f"–ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–∑–æ–≤–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é."
            )
            
            await message.answer(success_text, parse_mode="HTML")
            logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.full_name} (ID: {message.from_user.id}) –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
    
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: {e}")
        await message.answer("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
```

## üéØ bot/states/expense.py

```python
from aiogram.fsm.state import StatesGroup, State

class ExpenseForm(StatesGroup):
    waiting_amount = State()
    waiting_purpose = State()
    waiting_confirmation = State()
```

## üí∞ bot/handlers/expenses.py

```python
from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, CallbackQuery
from database.database import AsyncSessionLocal
from database.crud import ExpenseCRUD, ReminderCRUD
from services.google_sheets import google_sheets_service
from bot.states.expense import ExpenseForm
from bot.keyboards.inline import get_confirmation_keyboard, get_expense_completed_keyboard
from datetime import datetime, date
import logging

logger = logging.getLogger(__name__)
router = Router()

@router.callback_query(F.data == "expense")
async def start_expense_input(callback: CallbackQuery, state: FSMContext, current_user):
    """–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞"""
    await state.set_state(ExpenseForm.waiting_amount)
    
    text = (
        f"üí∞ <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞</b>\n\n"
        f"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <b>{current_user.full_name}</b>\n"
        f"üìÖ –î–∞—Ç–∞: <b>{datetime.now().strftime('%d.%m.%Y')}</b>\n\n"
        f"üíµ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–∞ (–≤ —Å–æ–º–∞—Ö):\n"
        f"<i>–ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –±—ã–ª–æ, –≤–≤–µ–¥–∏—Ç–µ 0</i>"
    )
    
    await callback.message.edit_text(text, parse_mode="HTML")
    await callback.answer()

@router.message(ExpenseForm.waiting_amount)
async def process_amount(message: Message, state: FSMContext, current_user):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É–º–º—ã —Ä–∞—Å—Ö–æ–¥–∞"""
    try:
        amount = float(message.text.replace(',', '.'))
        if amount < 0:
            await message.answer("‚ùå –°—É–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π. –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É:")
            return
        
        await state.update_data(amount=amount)
        await state.set_state(ExpenseForm.waiting_purpose)
        
        if amount == 0:
            purpose_text = (
                "üìù <b>–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤:</b>\n\n"
                "–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
                "‚Ä¢ –í—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å\n"
                "‚Ä¢ –ù–µ –±—ã–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–π\n"
                "‚Ä¢ –†–∞–±–æ—Ç–∞–ª —É–¥–∞–ª–µ–Ω–Ω–æ"
            )
        else:
            purpose_text = (
                f"üí∞ –°—É–º–º–∞: <b>{amount:,.2f} —Å–æ–º</b>\n\n"
                f"üìù <b>–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å —Ä–∞—Å—Ö–æ–¥–∞:</b>\n\n"
                f"–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
                f"‚Ä¢ –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞\n"
                f"‚Ä¢ –û–ø–ª–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É\n"
                f"‚Ä¢ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã\n"
                f"‚Ä¢ –õ–∏—á–Ω—ã–µ –Ω—É–∂–¥—ã"
            )
        
        await message.answer(purpose_text, parse_mode="HTML")
        
    except ValueError:
        await message.answer(
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã.\n"
            "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1500 –∏–ª–∏ 1500.50):"
        )

@router.message(ExpenseForm.waiting_purpose)
async def process_purpose(message: Message, state: FSMContext, current_user):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–ª–∏ —Ä–∞—Å—Ö–æ–¥–∞"""
    purpose = message.text.strip()
    
    if not purpose:
        await message.answer("‚ùå –¶–µ–ª—å —Ä–∞—Å—Ö–æ–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π. –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ:")
        return
    
    if len(purpose) > 500:
        await message.answer("‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤). –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ:")
        return
    
    data = await state.get_data()
    amount = data['amount']
    
    await state.update_data(purpose=purpose)
    await state.set_state(ExpenseForm.waiting_confirmation)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    confirmation_text = (
        f"üìã <b>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞</b>\n\n"
        f"üë§ <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</b> {current_user.full_name}\n"
        f"üìÖ <b>–î–∞—Ç–∞:</b> {datetime.now().strftime('%d.%m.%Y')}\n"
        f"üí∞ <b>–°—É–º–º–∞:</b> {amount:,.2f} —Å–æ–º\n"
        f"üìù <b>–¶–µ–ª—å:</b> {purpose}\n\n"
        f"‚ùì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞—Å—Ö–æ–¥?"
    )
    
    await message.answer(
        confirmation_text,
        parse_mode="HTML",
        reply_markup=get_confirmation_keyboard()
    )

@router.callback_query(F.data == "confirm_yes", ExpenseForm.waiting_confirmation)
async def confirm_expense(callback: CallbackQuery, state: FSMContext, current_user):
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞"""
    try:
        data = await state.get_data()
        amount = data['amount']
        purpose = data['purpose']
        
        async with AsyncSessionLocal() as db:
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å—Ö–æ–¥ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            expense = await ExpenseCRUD.create_expense(
                db=db,
                user_id=current_user.id,
                amount=amount,
                purpose=purpose
            )
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets
            await google_sheets_service.add_expense_to_sheet(
                user_name=current_user.full_name,
                amount=amount,
                purpose=purpose,
                expense_date=expense.created_at
            )
            
            # –û—Ç–º–µ—á–∞–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ
            today = date.today()
            pending_reminders = await ReminderCRUD.get_pending_reminders(db, today)
            for reminder in pending_reminders:
                if reminder.user_id == current_user.id:
                    await ReminderCRUD.mark_reminder_completed(db, reminder.id)
                    break
        
        success_text = (
            f"‚úÖ <b>–†–∞—Å—Ö–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!</b>\n\n"
            f"üìä –î–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É —É—á–µ—Ç–∞ –∏ Google –¢–∞–±–ª–∏—Ü—É.\n\n"
            f"–ß—Ç–æ –¥–∞–ª—å—à–µ?"
        )
        
        await callback.message.edit_text(
            success_text,
            parse_mode="HTML",
            reply_markup=get_expense_completed_keyboard()
        )
        await callback.answer("–†–∞—Å—Ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!")
        await state.clear()
        
        logger.info(f"–†–∞—Å—Ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {current_user.full_name} - {amount} —Å–æ–º")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞: {e}")
        await callback.message.edit_text("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        await callback.answer()
        await state.clear()

@router.callback_query(F.data == "confirm_no", ExpenseForm.waiting_confirmation)
async def cancel_expense(callback: CallbackQuery, state: FSMContext):
    """–û—Ç–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞"""
    from bot.keyboards.inline import get_main_menu_keyboard
    
    await callback.message.edit_text(
        "‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ.\n\nüè† –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
        reply_markup=get_main_menu_keyboard()
    )
    await callback.answer("–û—Ç–º–µ–Ω–µ–Ω–æ")
    await state.clear()
```

## üìä bot/handlers/status.py

```python
from aiogram import Router, F
from aiogram.types import CallbackQuery
from services.google_sheets import google_sheets_service
from bot.keyboards.inline import get_main_menu_keyboard
import logging

logger = logging.getLogger(__name__)
router = Router()

@router.callback_query(F.data == "status")
async def show_status(callback: CallbackQuery, current_user):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets
        status_data = await google_sheets_service.get_status_data()
        
        if not status_data:
            await callback.message.edit_text(
                "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å–∞.\n"
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets.",
                reply_markup=get_main_menu_keyboard()
            )
            await callback.answer()
            return
        
        # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0
        total_turnover = status_data.get('–û–±—â–∏–π –æ–±–æ—Ä–æ—Ç', 0)
        market_debt = status_data.get('–î–æ–ª–≥–∏ –≤ —Ä—ã–Ω–∫–µ', 0)  
        personal_expenses = status_data.get('–õ–∏—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã', 0)
        business_investment = status_data.get('–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å', 0)
        shop1_turnover = status_data.get('–û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 1', 0)
        shop2_turnover = status_data.get('–û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 2', 0)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        status_text = (
            f"üìä <b>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å</b>\n"
            f"üë§ –ó–∞–ø—Ä–æ—Å–∏–ª: {current_user.full_name}\n\n"
            
            f"üí∞ <b>1. –û–±—â–∏–π –æ–±–æ—Ä–æ—Ç:</b>\n"
            f"   {total_turnover:,.2f} —Å–æ–º\n\n"
            
            f"üè™ <b>2. –î–æ–ª–≥–∏ –≤ —Ä—ã–Ω–∫–µ:</b>\n" 
            f"   {market_debt:,.2f} —Å–æ–º\n\n"
            
            f"üë§ <b>3. –õ–∏—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:</b>\n"
            f"   {personal_expenses:,.2f} —Å–æ–º\n\n"
            
            f"üìà <b>4. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å:</b>\n"
            f"   {business_investment:,.2f} —Å–æ–º\n\n"
            
            f"üè¨ <b>5. –û–±–æ—Ä–æ—Ç –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º:</b>\n"
            f"   ‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω 1: {shop1_turnover:,.2f} —Å–æ–º\n"
            f"   ‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω 2: {shop2_turnover:,.2f} —Å–æ–º\n\n"
            
            f"üìã <b>–û–±—â–∏–µ —Å—É–º–º—ã:</b>\n"
            f"‚Ä¢ –í—Å–µ–≥–æ –æ–±–æ—Ä–æ—Ç: {total_turnover:,.2f} —Å–æ–º\n"
            f"‚Ä¢ –í—Å–µ–≥–æ –¥–æ–ª–≥–æ–≤: {market_debt:,.2f} —Å–æ–º\n\n"
            
            f"üïê <i>–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: {status_data.get('last_updated', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}</i>"
        )
        
        keyboard = get_main_menu_keyboard()
        
        await callback.message.edit_text(
            status_text,
            parse_mode="HTML",
            reply_markup=keyboard
        )
        await callback.answer()
        
        logger.info(f"–°—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—à–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {current_user.full_name}")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: {e}")
        await callback.message.edit_text(
            "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
            reply_markup=get_main_menu_keyboard()
        )
        await callback.answer()
```

## üìñ bot/handlers/instructions.py

```python
from aiogram import Router, F
from aiogram.types import CallbackQuery
from bot.keyboards.inline import get_main_menu_keyboard

router = Router()

@router.callback_query(F.data == "instructions")
async def show_instructions(callback: CallbackQuery, current_user):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞"""
    
    instructions_text = (
        f"üìñ <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</b>\n"
        f"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {current_user.full_name}\n\n"
        
        f"ü§ñ <b>–û –±–æ—Ç–µ:</b>\n"
        f"–≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É—á–µ—Ç–∞ –±–∏–∑–Ω–µ—Å-—Ä–∞—Å—Ö–æ–¥–æ–≤ –∫–æ–º–∞–Ω–¥—ã –∏–∑ 3 —á–µ–ª–æ–≤–µ–∫. "
        f"–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–∞—Ç–∞—Ö –∏ "
        f"–≤–µ–¥–µ—Ç —É—á–µ—Ç –≤ Google –¢–∞–±–ª–∏—Ü–∞—Ö.\n\n"
        
        f"üîê <b>1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</b>\n"
        f"‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: <code>/auth –í–ê–®_–ö–û–î</code>\n"
        f"‚Ä¢ –ö–æ–¥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\n"
        f"‚Ä¢ –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º\n\n"
        
        f"üí∞ <b>2. –ö–æ–º–∞–Ω–¥–∞ '–†–∞—Å—Ö–æ–¥'</b>\n"
        f"‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–†–∞—Å—Ö–æ–¥' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é\n"
        f"‚Ä¢ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (–µ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –±—ã–ª–æ, –≤–≤–µ–¥–∏—Ç–µ 0)\n"
        f"‚Ä¢ –£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–∏—á–∏–Ω—É —Ä–∞—Å—Ö–æ–¥–∞\n"
        f"‚Ä¢ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n"
        f"‚Ä¢ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Google –¢–∞–±–ª–∏—Ü—É\n\n"
        
        f"üìä <b>3. –ö–æ–º–∞–Ω–¥–∞ '–°—Ç–∞—Ç—É—Å'</b>\n"
        f"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:\n"
        f"‚Ä¢ –û–±—â–∏–π –æ–±–æ—Ä–æ—Ç –±–∏–∑–Ω–µ—Å–∞\n"
        f"‚Ä¢ –î–æ–ª–≥–∏ –≤ —Ä—ã–Ω–∫–µ (–æ–ø—Ç–æ–≤—ã–µ –∑–∞–∫—É–ø–∫–∏ –≤ –¥–æ–ª–≥)\n" 
        f"‚Ä¢ –õ–∏—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤\n"
        f"‚Ä¢ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∏–∑–Ω–µ—Å–∞\n"
        f"‚Ä¢ –û—Ç–¥–µ–ª—å–Ω—ã–π –æ–±–æ—Ä–æ—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –º–∞–≥–∞–∑–∏–Ω—É\n\n"
        
        f"üïê <b>4. –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</b>\n"
        f"‚Ä¢ –í 20:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ\n"
        f"‚Ä¢ –ï—Å–ª–∏ –Ω–µ –≤–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ, –±–æ—Ç –±—É–¥–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –∫–∞–∂–¥—ã–π —á–∞—Å\n"
        f"‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
        f"‚Ä¢ –í –ø–æ–ª–Ω–æ—á—å —Ü–∏–∫–ª –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ\n\n"
        
        f"üìã <b>5. Google –¢–∞–±–ª–∏—Ü—ã</b>\n"
        f"‚Ä¢ –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É\n"
        f"‚Ä¢ –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –±–µ—Ä—É—Ç—Å—è –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n"
        f"‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é\n\n"
        
        f"‚ùì <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:</b>\n\n"
        f"<b>Q:</b> –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –±—ã–ª–æ?\n"
        f"<b>A:</b> –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É 0 –∏ —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É (–≤—ã—Ö–æ–¥–Ω–æ–π, –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Ç.–¥.)\n\n"
        
        f"<b>Q:</b> –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ –∑–∞–ø–∏—Å–∏?\n"
        f"<b>A:</b> –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ Google –¢–∞–±–ª–∏—Ü–µ\n\n"
        
        f"<b>Q:</b> –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å?\n"
        f"<b>A:</b> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –ª–∏ –≤—ã, –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É\n\n"
        
        f"üìû <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>\n"
        f"–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã.\n\n"
        
        f"‚úÖ <b>–°–æ–≤–µ—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</b>\n"
        f"‚Ä¢ –í–Ω–æ—Å–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç—Ä–∞—Ç\n"
        f"‚Ä¢ –ë—É–¥—å—Ç–µ —Ç–æ—á–Ω—ã –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ü–µ–ª–µ–π —Ä–∞—Å—Ö–æ–¥–æ–≤\n"
        f"‚Ä¢ –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
        f"‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤"
    )
    
    await callback.message.edit_text(
        instructions_text,
        parse_mode="HTML",
        reply_markup=get_main_menu_keyboard()
    )
    await callback.answer()
```

## ü§ñ bot/create_bot.py

```python
from aiogram import Bot, Dispatcher
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from config import config
from bot.middlewares.auth import AuthMiddleware
from bot.handlers import auth, common, expenses, status, instructions

def create_bot() -> tuple[Bot, Dispatcher]:
    """–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞"""
    
    # –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
    bot = Bot(
        token=config.BOT_TOKEN,
        default=DefaultBotProperties(parse_mode=ParseMode.HTML)
    )
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä
    dp = Dispatcher()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ù–ï –¥–ª—è auth –∏ start –∫–æ–º–∞–Ω–¥)
    auth_middleware = AuthMiddleware()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã
    dp.include_router(auth.router)      # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–±–µ–∑ middleware)
    
    # –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã —Å middleware
    expenses.router.message.middleware(auth_middleware)
    expenses.router.callback_query.middleware(auth_middleware)
    
    status.router.callback_query.middleware(auth_middleware)
    instructions.router.callback_query.middleware(auth_middleware)
    common.router.message.middleware(auth_middleware)
    common.router.callback_query.middleware(auth_middleware)
    
    dp.include_router(expenses.router)
    dp.include_router(status.router)  
    dp.include_router(instructions.router)
    dp.include_router(common.router)    # –í –∫–æ–Ω—Ü–µ, –∫–∞–∫ fallback
    
    return bot, dp
```

## üöÄ main.py

```python
import asyncio
import logging
import sys
from bot.create_bot import create_bot
from database.database import create_tables
from services.scheduler import SchedulerService

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler(sys.stdout)
    ]
)

logger = logging.getLogger(__name__)

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    logger.info("–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞...")
    
    try:
        # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        await create_tables()
        logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
        
        # –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
        bot, dp = create_bot()
        logger.info("–ë–æ—Ç —Å–æ–∑–¥–∞–Ω")
        
        # –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
        scheduler = SchedulerService(bot)
        scheduler.start()
        logger.info("–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º polling
        logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        await dp.start_polling(bot)
        
    except Exception as e:
        logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    finally:
        # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        if 'scheduler' in locals():
            scheduler.stop()
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

if __name__ == "__main__":
    asyncio.run(main())
```

## üóÇÔ∏è utils/helpers.py

```python
from datetime import datetime
import re

def format_amount(amount: float) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º—ã —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á"""
    return f"{amount:,.2f}".replace(",", " ")

def validate_amount(amount_str: str) -> tuple[bool, float]:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Å—É–º–º—ã"""
    try:
        # –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
        amount_str = amount_str.replace(",", ".")
        
        # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã
        amount_str = re.sub(r'\s', '', amount_str)
        
        # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ
        amount = float(amount_str)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω
        if amount < 0:
            return False, 0.0
        
        if amount > 10000000:  # 10 –º–ª–Ω —Å–æ–º –º–∞–∫—Å–∏–º—É–º
            return False, 0.0
        
        return True, amount
        
    except ValueError:
        return False, 0.0

def format_datetime_kg(dt: datetime) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞"""
    months = [
        "—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è",
        "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"
    ]
    
    day = dt.day
    month = months[dt.month - 1]
    year = dt.year
    time = dt.strftime("%H:%M")
    
    return f"{day} {month} {year} –≥. –≤ {time}"
```

## üìÑ .gitignore

```gitignore
# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# Environment variables
.env
.env.local
.env.production

# Database
*.db
*.sqlite3
data/bot.db

# Google Credentials
data/credentials.json
credentials.json

# Logs
*.log
logs/

# Virtual environment
venv/
env/
.venv/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Temporary files
*.tmp
*.temp
```

## üê≥ Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
RUN mkdir -p data

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["python", "main.py"]
```

## üîß docker-compose.yml

```yaml
version: '3.8'

services:
  telegram-bot:
    build: .
    container_name: finance_telegram_bot
    restart: unless-stopped
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - GOOGLE_SHEETS_ID=${GOOGLE_SHEETS_ID}
      - TIMEZONE=Asia/Bishkek
      - REMINDER_TIME=20:00
      - AUTH_CODE_USER1=${AUTH_CODE_USER1}
      - AUTH_CODE_USER2=${AUTH_CODE_USER2}
      - AUTH_CODE_USER3=${AUTH_CODE_USER3}
      - DATABASE_URL=sqlite+aiosqlite:///./data/bot.db
      - DEBUG=False
    depends_on:
      - db
    networks:
      - bot-network

  db:
    image: postgres:15-alpine
    container_name: finance_bot_db
    restart: unless-stopped
    environment:
      POSTGRES_DB: finance_bot
      POSTGRES_USER: ${DB_USER:-botuser}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-securepassword123}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - bot-network
    ports:
      - "5432:5432"

volumes:
  postgres_data:

networks:
  bot-network:
    driver: bridge
```

## üìã README.md

```markdown
# üí∞ Finance Telegram Bot

Telegram –±–æ—Ç –¥–ª—è —É—á–µ—Ç–∞ –±–∏–∑–Ω–µ—Å-—Ä–∞—Å—Ö–æ–¥–æ–≤ –∫–æ–º–∞–Ω–¥—ã —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Sheets –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∫–æ–¥–∞–º
- üí∞ –£–¥–æ–±–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets
- ‚è∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ 20:00 –ø–æ –ö—ã—Ä–≥—ã–∑—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
- üì¢ –ü–æ—á–∞—Å–æ–≤—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
\`\`\`bash
git clone <repository-url>
cd telegram_finance_bot
\`\`\`

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
\`\`\`bash
pip install -r requirements.txt
\`\`\`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

\`\`\`bash
cp .env.example .env
\`\`\`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets API
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Google Cloud Console
2. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account
4. –°–∫–∞—á–∞–π—Ç–µ credentials.json –≤ –ø–∞–ø–∫—É `data/`
5. –°–æ–∑–¥–∞–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É –∏ –¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø Service Account
6. –î–æ–±–∞–≤—å—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ã –≤ `.env`

### 6. –ó–∞–ø—É—Å–∫
\`\`\`bash
python main.py
\`\`\`

## üê≥ Docker

\`\`\`bash
docker-compose up -d
\`\`\`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google Sheets

### –õ–∏—Å—Ç "–†–∞—Å—Ö–æ–¥—ã" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è)
| –î–∞—Ç–∞ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –°—É–º–º–∞ | –¶–µ–ª—å | –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ |

### –õ–∏—Å—Ç "–°—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã–µ" (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| –û–±—â–∏–π –æ–±–æ—Ä–æ—Ç | 0 |
| –î–æ–ª–≥–∏ –≤ —Ä—ã–Ω–∫–µ | 0 |
| –õ–∏—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã | 0 |
| –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å | 0 |
| –û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 1 | 0 |
| –û–±–æ—Ä–æ—Ç –º–∞–≥–∞–∑–∏–Ω 2 | 0 |

## üë• –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `/auth [–∫–æ–¥]` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `üí∞ –†–∞—Å—Ö–æ–¥` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
- `üìä –°—Ç–∞—Ç—É—Å` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- `üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **Python**: 3.11+
- **Framework**: aiogram 3.x
- **Database**: SQLite/PostgreSQL
- **Scheduler**: APScheduler
- **Timezone**: Asia/Bishkek

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã.
\`\`\`

---

## üéØ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram Bot Token:
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API
4. –°–æ–∑–¥–∞–π—Ç–µ Service Account
5. –°–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á
6. –°–æ–∑–¥–∞–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É
7. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø Service Account (–ø–æ email –∏–∑ JSON)
8. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ã –∏–∑ URL

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- USER1: `SECURE_CODE_123`
- USER2: `SECURE_CODE_456`  
- USER3: `SECURE_CODE_789`

### 4. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:
1. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`
2. –ü–æ–º–µ—Å—Ç–∏—Ç–µ `credentials.json` –≤ –ø–∞–ø–∫—É `data/`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `python main.py`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
5. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å: `/auth –í–ê–®_–ö–û–î`

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ 20:00 –ø–æ –ö—ã—Ä–≥—ã–∑—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø CLAUDE CODE

- [ ] –°–æ–∑–¥–∞—Ç—å –≤—Å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt
- [ ] –°–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ handlers (auth, expenses, status, instructions)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Google Sheets API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å Docker —Ñ–∞–π–ª—ã
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤ Claude Code!**